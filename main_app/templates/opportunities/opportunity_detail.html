{% extends 'base.html' %}

{% comment %} main_app/templates/opportunities/opportunity_detail.html {% endcomment %}

{% block content %}
  <h1>{{ opportunity.title }}</h1>

  <p><strong>Description:</strong> {{ opportunity.description }}</p>
  <p><strong>Location:</strong> {{ opportunity.location }}</p>
  <p><strong>Age Requirement:</strong> {{ opportunity.age_requirement }}+</p>
  <p><strong>Volunteers Needed:</strong> {{ opportunity.num_volunteers_needed }}</p>

  {% if opportunity.certification_required %}
    <p><strong>Certifications Required:</strong> {{ opportunity.certifications_list }}</p>
  {% endif %}

  <p><strong>Organization:</strong> {{ opportunity.organization.name }}</p>

  {% if is_filled %}
    <p><strong>Status:</strong> This opportunity is full.</p>
  {% else %}
    <p><strong>Status:</strong> Active</p>
  {% endif %}

  {% if user.is_authenticated %}
    {% if user == opportunity.organization.user or user.is_superuser %}
      <a href="{% url 'applicants-list' opportunity.id %}">View Applicants</a>

      {% if not is_filled %}
        <form method="post" action="{% url 'mark-as-filled' opportunity.id %}">
          {% csrf_token %}
          <button type="submit">Mark Opportunity as Filled</button>
        </form>
      {% else %}
        <p>This opportunity is filled and no further applications are allowed.</p>
      {% endif %}

      <a href="{% url 'opportunity-edit' opportunity.id %}">Edit</a>
      <form method="post" action="{% url 'opportunity-delete' opportunity.id %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" onclick="return confirm('Are you sure you want to delete this opportunity?');">Delete</button>
      </form>
    {% elif user.volunteerprofile %}
      <form method="post" action="{% url 'apply-opportunity' opportunity.id %}">
        {% csrf_token %}
        <button type="submit" {% if is_filled %} disabled {% endif %}>Apply to This Opportunity</button>
      </form>
    {% endif %}
  {% else %}
    <p><a href="{% url 'login' %}">Log in</a> to apply.</p>
  {% endif %}

  <br><a href="{% url 'home' %}">‚Üê Back to Home</a>
{% endblock %}
